# API keys are redacted to maintain proper security
# ===== REQUIRED BROKER SECRETS =====
ALPACA_API_KEY={REDACTED}
ALPACA_SECRET_KEY={REDACTED}
# Base URL (keep both until code is unified)
ALPACA_BASE_URL=https://paper-api.alpaca.markets
ALPACA_API_URL=${ALPACA_BASE_URL}

# ===== DATA FEED & PROVIDERS =====
# Primary provider: Alpaca. Backup: Yahoo (batched via yfinance)
DATA_PROVIDER_PRIORITY=alpaca_iex,yahoo
DATA_PROVIDER=alpaca
DAILY_SOURCE=alpaca
MINUTE_SOURCE=alpaca
BACKUP_PROVIDER=yfinance
AI_TRADING_PROVIDER_SWITCH_COOLDOWN_SEC=420
AI_TRADING_PROVIDER_HEALTH_PASSES_REQUIRED=4

# Your current plan/feed setup
DATA_FEED_INTRADAY=iex
ALPACA_DATA_FEED=iex
AI_TRADING_SAFE_MODE_ALLOW_PAPER=1
AI_TRADING_SAFE_MODE=0
ALPACA_FEED_FAILOVER=iex
ALPACA_ALLOW_SIP=0
ALPACA_SIP_UNAUTHORIZED=1
ALPACA_ADJUSTMENT=all
ALPACA_HAS_SIP=0
SENTIMENT_MAX_CALLS_PER_MIN=6
SENTIMENT_SUCCESS_TTL_SEC=3600

# Global request budget (requests per minute)
ALPACA_RATE_LIMIT_PER_MIN=200

# Conservative host concurrency for Basic plan (single, canonical knob for tests)
AI_TRADING_HTTP_HOST_LIMIT=3

# ===== OPTIONAL PROVIDERS =====
ENABLE_FINNHUB=1
FINNHUB_API_KEY={REDACTED}
NEWS_API_KEY={REDACTED}
SENTIMENT_API_KEY=${NEWS_API_KEY}
SENTIMENT_API_URL=https://newsapi.org/v2/everything

# ===== SECURITY =====
WEBHOOK_SECRET={REDACTED}
# ===== RUNTIME / SERVER =====
API_HOST=0.0.0.0
# Align health with app port to match logs and avoid confusion
API_PORT=9001
HEALTHCHECK_PORT=9001

AI_TRADING_HEALTH_TICK_SECONDS=300
TZ=UTC
MARKET_CALENDAR=XNYS
EXECUTION_MODE=paper
EXECUTION_SAFE_MODE=0
SHADOW_MODE=0

# ===== LOOP / SCHEDULING =====
AI_TRADING_INTERVAL=150
AI_TRADING_ITERATIONS=0
AI_TRADING_SEED=42
INTERVAL_WHEN_CLOSED=300

# ===== PATHS / ARTIFACTS =====
AI_TRADING_RL_MODEL_PATH=rl_agent.zip
HALT_FLAG_PATH=halt.flag
AI_TRADING_MODEL_MODULE=ai_trading.simple_models

# ===== STRATEGY / MODES =====
TRADING_MODE=balanced
USE_RL_AGENT=0
CPU_ONLY=1

# ===== RISK & POSITION SIZING =====
CAPITAL_CAP=0.06
DOLLAR_RISK_LIMIT=0.05
AI_TRADING_MAX_DRAWDOWN_THRESHOLD=0.08

AI_TRADING_MAX_PORTFOLIO_POSITIONS=10
AI_TRADING_MAX_POSITION_SIZE=25000
MAX_POSITION_MODE=AUTO

# ===== WORKERS / PERFORMANCE =====
AI_TRADING_ENABLE_MEMORY_OPTIMIZATION=1
AI_TRADING_EXEC_WORKERS=1
AI_TRADING_PRED_WORKERS=1
EXEC_WORKERS_WHEN_CLOSED=1
DYNAMIC_SIZE_REFRESH_SECS=1800
CYCLE_BUDGET_FRACTION=0.9

# ===== HTTP CLIENT TUNING (Basic-plan safe) =====
HTTP_MAX_WORKERS=3
HTTP_POOL_MAXSIZE=16

HTTP_TIMEOUT_S=10
HTTP_TOTAL_RETRIES=2
HTTP_BACKOFF_FACTOR=0.3
HTTP_CONNECT_TIMEOUT=4.0
HTTP_READ_TIMEOUT=12.0
HTTP_CONNECT_TIMEOUT_CLOSED=3.0
HTTP_READ_TIMEOUT_CLOSED=6.0

# Per-host vendor caps (tightened for Alpaca Basic)
HTTP_RPS_LIMIT_paper_api_alpaca_markets=2
HTTP_RETRIES_paper_api_alpaca_markets=2
HTTP_BACKOFF_paper_api_alpaca_markets=0.2
HTTP_RPS_LIMIT_finnhub_io=5

# ===== LOGGING =====
LOG_LEVEL=DEBUG
LOG_LEVEL_HTTP=DEBUG
AI_TRADING_LOG_TIMINGS_LEVEL=DEBUG
AI_TRADING_LOG_RATE_LIMIT_WINDOW_SEC=120
AI_TRADING_EXEC_DEBUG=1
AI_TRADING_EXEC_LOG_REQUESTS=1
AI_TRADING_EXEC_LOG_RAW_RESPONSES=1
AI_TRADING_EXEC_STRICT=1
EXECUTION_STRICT_READINESS=0

# ===== DATA QUALITY / PROVIDER DECISIONS =====
AI_TRADING_GAP_RATIO_LIMIT=0.03
AI_TRADING_GAP_LIMIT_BPS=500
AI_TRADING_NBBO_GAP_LIMIT_BPS=500
AI_TRADING_FALLBACK_GAP_LIMIT_BPS=500
AI_TRADING_PROVIDER_DECISION_SECS=300
AI_TRADING_FALLBACK_QUOTE_MAX_AGE_SEC=30
AI_TRADING_STRICT_GATING=1
AI_TRADING_MINUTE_ABORT_ON_GAPS=0
AI_TRADING_LIQ_FALLBACK_CAP=0.25

# ===== CACHE SETTINGS =====
MINUTE_CACHE_TTL=300
MARKET_CACHE_TTL=86400

# ===== Minute-data tolerance (reduces false alarms when market is closed) =====
MINUTE_STALE_TOLERANCE_SEC=600
SKIP_MINUTE_CHECK_WHEN=market_closed

# ===== yfinance (backup) hygiene & batching =====
YF_TIMEOUT=8
YF_RETRIES=3
YF_BACKOFF=0.7
YF_CHUNK_SIZE=40
YF_CACHE_DIR=/var/cache/ai-trading-bot/yf

# ===== Screener throttles (less churn, fewer fetches) =====
SCREEN_BATCH_SIZE=25
SCREEN_TOPN=10
SCREEN_MIN_REFETCH_SEC=1800

AI_TRADING_EXEC_ALLOW_FALLBACK_WITHOUT_NBBO=1
EXECUTION_ALLOW_FALLBACK_WITHOUT_NBBO=1

# allow using last_close / fallback prices
AI_TRADING_EXEC_ALLOW_FALLBACK_PRICE=0
AI_TRADING_EXEC_ALLOW_LAST_CLOSE=0
EXECUTION_ALLOW_LAST_CLOSE=0

# tolerate missing bid/ask (no broker NBBO on Basic/IEX)
EXECUTION_REQUIRE_BID_ASK=1
EXECUTION_REQUIRE_REALTIME_NBBO=0
EXECUTION_MAX_STALENESS_SEC=60
DATA_MAX_GAP_RATIO_BPS=500
